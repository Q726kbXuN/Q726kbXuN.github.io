<!DOCTYPE html><html><head><meta charset="utf-8"/><link rel="icon" type="image/png" sizes="16x16" href="spyglass.png"/><title>Search</title><style>html,body {background-color: #333;color: #ccc;font-family: "Roboto", sans-serif;font-size: 12pt;}a {color: #ccf;text-decoration: none;}ul {list-style-type: none;}li {margin-bottom: 0.5em;}a:hover {color: #ccf;text-decoration: underline;}.title {font-weight: bold;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #888;padding-left: 1em;padding-bottom: 0;margin: 0;font-size: 12pt;}.hit {text-indent: -2em;margin-left: 2em;}input[type="text"] {background-color: #000;color: #cec;border-top-style: hidden;border-right-style: hidden;border-left-style: hidden;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #a8a8f2;padding: 2px;outline: none;}</style><script>async function getData(data_num, start, len, loadMode='gzipDecode') {const resp = await fetch("./search_data_" + String(data_num).padStart(2, '0') + ".dat",{'headers': {'Range': 'bytes=' + start + "-" + (start + len - 1),},},);if (loadMode == 'gzipDecode') {const blob = await resp.blob();const ds = new DecompressionStream("gzip");const decomp = blob.stream().pipeThrough(ds);const decoded = await new Response(decomp).blob();const text = await decoded.text();const parsed = JSON.parse(text);return parsed;} else if (loadMode == 'asText') {const text = await resp.text();return text;} else if (loadMode == 'json') {const text = await resp.text();const parsed = JSON.parse(text);return parsed;}}function showHit(item, search, bail, found) {let ret = [];let words = item['words'].split('|');let start = [];let last = 0;for (let cur of item['start']) {last += cur;start.push(last);}let speaker = item['speaker'].split('');search = search.split(' ');let find = search.join(' ').toLowerCase();for (let hitAt = 0; hitAt < words.length; hitAt++) {if (words.slice(hitAt, hitAt + search.length).join(' ').toLowerCase() == find) {let hit = document.createElement("p");ret.push(hit);let header = document.createElement("h1");hit.appendChild(header);header.innerText = item['title'];header.className = "title";let lastSpeaker = '';let phraseStartAt = 0;let startAt = -1;let phrase = null;for (let i = Math.max(0, hitAt - 5); i <= Math.min(hitAt + search.length + 500, words.length - 1); i++) {if (startAt >= 0 && ((start[i] / 100) - startAt) > 60) {break;}if (phrase === null || lastSpeaker != speaker[i] || ((start['i'] / 100) - phraseStartAt) >= 30) {lastSpeaker = speaker[i];phraseStartAt = start[i] / 100;if (startAt === -1) {startAt = phraseStartAt;}let text = document.createElement('p');hit.appendChild(text);text.className = "hit";let time = document.createElement('span');text.appendChild(time);let at = start[hitAt];let val = "";val += Math.floor(at / 3600).toString() + ":";val += (Math.floor(at / 60) % 60).toString().padStart(2, "0") + ":";val += (at % 60).toString().padStart(2, "0") + ":";time.innerText = val;phrase = document.createElement('span');text.appendChild(phrase);}phrase.innerText += " " + words[i];}bail--;found++;if (bail == 0) {let comment = document.createElement('span');ret.push(comment);comment.innerText = "(Too many hits!)";break;}}}return [ret, bail, found];}async function search(search) {let searchHit = "|" + search.toLowerCase().replace(/ /g, "|") + "|";let info = await getData(0, 0, 25, "json");let batches = await getData(...info);let temp = [];let bail = 100;let found = 0;for (let batch of batches) {if (bail == 0) {break;}batch = await(getData(...batch));for (let item of batch) {if (bail == 0) {break;}if (("|" + item["words"].toLowerCase() + "|").includes(searchHit)) {let items = showHit(item, search, bail);console.log(items);temp = temp.concat(items[0]);bail = items[1];found = items[2];}}}if (found == 0) {let comment = document.createElement('span');temp.push(comment);comment.innerText = "(No matches found)";}document.getElementById("results").replaceChildren(...temp);}function handleKey(e) {if (e.keyCode === 13) {e.preventDefault();search(document.getElementById('search').value).then();}}</script></head><body>Search term: <input id="search" type="text" size=50 autocomplete="off" autocorrect="off" onkeyup="handleKey(event);"><br><br><span id="results">...</span></body></html>